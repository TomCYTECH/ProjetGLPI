CREATE TABLE GLPI_LIEU (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOM VARCHAR2(100),
    CONSTRAINT PK_LIEU PRIMARY KEY (ID)
);

CREATE TABLE GLPI_TYPE (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOM VARCHAR2(100),
    DESCRIPTION VARCHAR2(1000),
    CONSTRAINT PK_TYPE PRIMARY KEY (ID)
);

CREATE TABLE GLPI_SITE (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    LIEU_ID NUMBER(10),
    NOM VARCHAR2(100),
    CONSTRAINT PK_SITE PRIMARY KEY (ID),
    CONSTRAINT FK_SITE_LIEU FOREIGN KEY (LIEU_ID) REFERENCES GLPI_LIEU(ID)
);

CREATE TABLE GLPI_EQUIPEMENT (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NUMERO_SERIE VARCHAR2(100) NOT NULL UNIQUE,
    NOM VARCHAR2(100),
    TYPE_ID NUMBER(10),
    LIEU_ID NUMBER(10),
    SITE_ID NUMBER(10),
    CONSTRAINT PK_EQUIPEMENT PRIMARY KEY (ID),
    CONSTRAINT FK_TYPE FOREIGN KEY (TYPE_ID) REFERENCES GLPI_TYPE(ID),
    CONSTRAINT FK_EQUIPEMENT_LIEU FOREIGN KEY (LIEU_ID) REFERENCES GLPI_LIEU(ID),
    CONSTRAINT FK_SITE FOREIGN KEY (SITE_ID) REFERENCES GLPI_SITE(ID)
);

CREATE TABLE GLPI_UTILISATEUR (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOM VARCHAR2(100),
    PRENOM VARCHAR2(100),
    EMAIL VARCHAR2(100),
    ROLE VARCHAR(20) CONSTRAINT role_check CHECK (ROLE IN ('ADMINISTRATEUR', 'TECHNICIEN', 'UTILISATEUR')),
    SITE_ID NUMBER(10),
    CONSTRAINT PK_UTILISATEUR PRIMARY KEY (ID),
    CONSTRAINT FK_SITE_UTILISATEUR FOREIGN KEY (SITE_ID) REFERENCES GLPI_SITE(ID)
);

CREATE TABLE GLPI_TICKET (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    NOM VARCHAR2(100),
    EQUIPEMENT_ID NUMBER(10),
    CREATION_DATE DATE,
    UTILISATEUR_ID NUMBER(10),
    DESCRIPTION VARCHAR2(1000),
    SITE_ID NUMBER(10),
    STATUT VARCHAR2(20) CONSTRAINT staut_check CHECK (STATUT IN ('EN_COURS', 'OUVERT', 'FERME')),
    CONSTRAINT PK_TICKET PRIMARY KEY (ID),
    CONSTRAINT FK_TICKETS_EQUIPEMENT FOREIGN KEY (EQUIPEMENT_ID) REFERENCES GLPI_EQUIPEMENT(ID),
    CONSTRAINT FK_UTILISATEUR_TICKET FOREIGN KEY (UTILISATEUR_ID) REFERENCES GLPI_UTILISATEUR(ID),
    CONSTRAINT FK_SITE_TICKET FOREIGN KEY (SITE_ID) REFERENCES GLPI_SITE(ID)
);

-- Vérifier qu'à l'insertion, les dates correspondent
CREATE TABLE GLPI_LOCATION (
    ID NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY,
    EQUIPEMENT_ID NUMBER(10),
    UTILISATEUR_ID NUMBER(10),
    DEBUT DATE,
    FIN DATE,
    CONSTRAINT PK_LOCATION PRIMARY KEY (ID),
    CONSTRAINT FK_LOCATION_EQUIPEMENT FOREIGN KEY (EQUIPEMENT_ID) REFERENCES GLPI_EQUIPEMENT(ID),
    CONSTRAINT FK_LOCATION_UTILISATEUR FOREIGN KEY (UTILISATEUR_ID) REFERENCES GLPI_UTILISATEUR(ID)
);
COMMIT;
